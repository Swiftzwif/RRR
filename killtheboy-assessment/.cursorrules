# Trajectory Grand Canyon "Strata" MVP

## Project Overview

High-polish UI skeleton with canyon-inspired strata visuals. Functional assessment end-to-end (store to Supabase, gate results by email/login). Stripe checkout for course & coaching; webhook grants access. TBD modules render premium "coming soon" with end-goal briefs + notify capture.

## Tech Stack

- **Framework**: Next.js (App Router, TypeScript)
- **Styling**: Tailwind CSS with custom canyon theme
- **Animations**: Framer Motion (subtle, 60fps target)
- **Database**: Supabase
- **Payments**: Stripe
- **Validation**: Zod for API inputs

## Design System

### Color Palette

```css
/* Canyon-inspired color tokens */
colors: {
  ink: '#0D0D0F',           /* Deep canyon shadow */
  'sand-50': '#F8F4EF',     /* Lightest strata */
  'sand-100': '#EDE5DB',    /* Light strata */
  'sand-200': '#D9CBB6',    /* Medium strata */
  'iron-400': '#7A7C80',    /* Rock formations */
  'iron-600': '#4C4F55',    /* Darker rock */
  sunset: '#D6722C',        /* Canyon sunset */
  'sunset-dark': '#B85D22', /* Deep sunset */
  glow: '#F0A15E',          /* Warm glow */
  success: '#4CAF50',       /* Growth/positive */
  warn: '#EDB64F',          /* Caution */
  danger: '#D64545'         /* Error/negative */
}
```

### Typography

- **Primary**: Inter (clean, readable)
- **Display**: Clash/General Sans (canyon-inspired headings)

## Architecture Principles

### File Structure

- **Components**: Keep small, composable, presentational when possible
- **Business Logic**: Centralized in `/lib` directory
- **API Routes**: Use server actions or route handlers for secure operations
- **Never expose secrets client-side**

### Performance & Accessibility

- **Animations**: Subtle, no layout thrash, 60fps target
- **A11y**: Strong accessibility, AA contrast, keyboard navigation on assessment
- **Responsive**: Support sm–xl breakpoints
- **Performance**: Limit blur/filters, Lighthouse pass for a11y & performance

## Core Components

### Required Components

- `CanyonHero`: Multi-layer SVG with parallax
- `StrataDivider`: Topographic overlay dividers
- `AvatarBadge`: User avatar with canyon styling
- `Meter`: Domain scoring visualization
- `AssessmentStepper`: Step-by-step question flow
- `ResultCard`: Assessment results display
- `ModuleCardTBD`: Premium "coming soon" cards
- `Paywall`: Stripe checkout integration
- `Toast`: Notification system

### Framer Motion Patterns

- Hero parallax scrolling
- Meter fill animations
- Avatar reveal transitions

## Page Structure

### Required Pages

- `/` - Landing with CanyonHero
- `/story` - Brand narrative
- `/assessment` - 15+2 question flow
- `/results` - Avatar, domain meters, CTAs
- `/course` - Premium content (gated)
- `/coaching` - Coaching application (gated)
- `/community` - Community access (gated)
- `/auth/signin` - Authentication

## Assessment Flow

### Question System

- Import from [questions.json](mdc:killtheboy-assessment/src/content/questions.json)
- Step-by-step flow with progress tracking
- Compute domain scores + avatar via [scoring.ts](mdc:killtheboy-assessment/src/lib/scoring.ts)

### Results Gating

- If user not authenticated: require email input
- Store to Supabase assessments table with email
- Navigate to `/results` after email capture

## Results Page

- Render Avatar and domain meters
- 7/30-day suggested actions (placeholder mapping by lowest domains)
- CTA cards for Course (Stripe Checkout) and Coaching Interview (Stripe Checkout)

## Payment Integration

### Stripe Setup

- Client-side checkout implementation
- Webhook handler at `/api/stripe/webhook`
- On success: write purchases row
- **Course**: Unlock `/course` access
- **Coaching**: Create coaching_applications + redirect to `ENV:COACHING_SCHEDULER_URL`

## TBD Modules

### Premium Content

- `/course` (locked until purchase): ModuleCardTBD items with end-goal blurbs
- `/community`: Gated page with Lodge description
- "Notify me" email capture via `POST /api/notify`

## Environment Variables

### Required

```env
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=
COACHING_SCHEDULER_URL=
```

## Development Guidelines

### Code Quality

- Use Zod for API input validation
- Keep components small and composable
- No blocking animations
- Server actions for secure operations

### Testing & QA

- Validate keyboard navigation
- Check focus states
- Respect reduced motion preference
- Responsive design (sm–xl)
- Lighthouse pass for a11y & performance

## Key Files Reference

- [Supabase config](mdc:killtheboy-assessment/src/lib/supabase.ts)
- [Scoring logic](mdc:killtheboy-assessment/src/lib/scoring.ts)
- [Questions data](mdc:killtheboy-assessment/src/content/questions.json)
- [Global styles](mdc:killtheboy-assessment/src/app/globals.css)

## Agentic Control Framework Integration ✅

**Successfully integrated and tested the Agentic Control Framework MCP tool for enhanced development workflow:**

### Framework Capabilities Tested:
- ✅ **Project Initialization**: Successfully initialized "Trajectory Strata MVP" project
- ✅ **Task Management**: Added and managed development tasks with priority levels
- ✅ **Status Tracking**: Updated task statuses (todo, inprogress, done, blocked, error)
- ✅ **Task Organization**: Created hierarchical task structure with subtasks
- ✅ **Progress Monitoring**: Real-time task progress tracking and activity logs

### Tasks Successfully Managed:
1. **Trajectory Platform: Complete Strata MVP Rebuild** (Priority: Critical)
   - Status: In Progress - Build successful, development server running
2. **Trajectory Platform: Supabase Database Setup** (Priority: High)  
   - Status: In Progress - Environment variables configured
3. **Trajectory Platform: Assessment Module Integration** (Priority: High)
   - Status: Todo - Ready for integration testing
4. **Trajectory Platform: Payment Integration (TBD)** (Priority: Medium)
   - Status: Done - All Stripe integrations properly marked as TBD

### Framework Benefits:
- **Enhanced Organization**: Comprehensive task tracking across the entire Trajectory platform
- **Priority Management**: Critical/High/Medium priority system for development focus
- **Progress Visibility**: Clear status updates and activity logging
- **Workflow Efficiency**: Structured approach to complex multi-module development

**Recommendation**: Continue using the Agentic Control Framework for all future Trajectory platform development to maintain organized, trackable progress across all submodules and components.

